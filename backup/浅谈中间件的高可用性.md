[TOC]


## 前言
> 系统在面对 高并发、高性能、高可用 场景时，除了系统本身的优化外，往往被中间件的“三高”给限制，本文着重分析常见中间件(MySQL、Redis、Kafka)的高可用方案。


## 什么是高可用
高可用：High Availability，缩写HA，指系统无中断地执行其功能的能力，高可用性通过提高系统的容错能力来实现。

## 为什么要高可用
作为系统中最重要的中间件：关系型数据库MySQL，一定要保证高可用，否则系统无法进行读写，如果MySQL挂了，那么就可以认为系统宕机了。
类似地，如果系统依赖Redis作为业务处理流程中的节点(*非简单缓存*)，如果Redis挂了那么业务就无法进行下去；Kafka也是一样。

## 如何实现高可用
> 高可用的实现方式通常是提高系统的容错能力，能够在部分服务宕机的情况下实现自动故障转移。

系统故障转移的基础：
1. 多副本节点；
2. 节点间数据的复制能力，即 Replication；
3. 理想状态下，任意时间点各个节点的数据一致；
4. 监控机制，节点发生故障时，监控系统能够知晓；
5. 选举机制，监控系统通过算法选举出能够替代故障节点的新节点负责对外服务。

其中，1/4/5都能够完美地实现，而2/3的节点间的一致性复制能力则由于硬件性能、网络的不稳定性等原因，而出现不可控的误差。
为了解决节点间数据的一致性，通常会有不同的复制实现方案：

| 方案       | 实现                                                         | 优点                                        | 缺点                                                         |
| ---------- | ------------------------------------------------------------ | ------------------------------------------- | ------------------------------------------------------------ |
| 异步复制   | 主节点完成事务并写入日志后即返回响应，副本通过日志等方式进行同步 | 1. 速度快，性能高                           | 1. 如果日志未同步给副本时主机故障，则导致一定的数据丢失      |
| 半同步复制 | 主节点等待一个副本ack后即返回响应                            | 1. 速度较快，能够保证至少一个副本有完整数据 | 1. 如果副本响应缓慢，如大量读操作、硬件性能差等，会降低主节点性能 |
| 全同步复制 | 主节点等待半数以上的副本ack后才返回响应                      | 1. 确保多节点之间的数据的一致性             | 1. 性能较差                                                  |

基本上多节点副本之间的复制方式就以上三种或其变种，可以看出它们是在数据一致性和性能之间做取舍。

下面分别从三种中间件的高可用架构方案来分析：




### MySQL

### Redis

### Kafka
### Others
